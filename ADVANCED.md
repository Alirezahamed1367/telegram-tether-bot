# ğŸ”§ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ - Ø®ÙˆØ§Ù†Ø¯Ù† Ú©Ø§Ù†Ø§Ù„ Ø¹Ù…ÙˆÙ…ÛŒ

## Ù…Ø´Ú©Ù„: Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ Ø¹Ù…ÙˆÙ…ÛŒ

Ø±Ø¨Ø§Øªâ€ŒÙ‡Ø§ÛŒ ØªÙ„Ú¯Ø±Ø§Ù… Ø¨Ù‡ ØµÙˆØ±Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ø§Ø² Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ Ø¨Ø®ÙˆØ§Ù†Ù†Ø¯ (Ø­ØªÛŒ Ø§Ú¯Ø± Ú©Ø§Ù†Ø§Ù„ Ø¹Ù…ÙˆÙ…ÛŒ Ø¨Ø§Ø´Ø¯).

## Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§

### Ø±Ø§Ù‡â€ŒØ­Ù„ Û±: Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±Ø¨Ø§Øª Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ (Ø³Ø§Ø¯Ù‡â€ŒØªØ±ÛŒÙ†)

Ø§Ú¯Ø± Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ `@tetherprice_toman` Ø¯Ø§Ø±ÛŒØ¯:
1. Ø±Ø¨Ø§Øª Ø±Ø§ Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
2. Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ ØªØºÛŒÛŒØ± Ú©Ø¯ Ù†ÛŒØ³Øª

âœ… **Ù…Ø²Ø§ÛŒØ§:** Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ú©Ø¯  
âŒ **Ù…Ø¹Ø§ÛŒØ¨:** Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ú©Ø§Ù†Ø§Ù„

---

### Ø±Ø§Ù‡â€ŒØ­Ù„ Û²: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Telethon (User Account)

Ø§Ú¯Ø± Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ù†Ø¯Ø§Ø±ÛŒØ¯ØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø§ **Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ** Ø®ÙˆØ¯ Ø§Ø² Ú©Ø§Ù†Ø§Ù„ Ø¨Ø®ÙˆØ§Ù†ÛŒØ¯.

#### Ù…Ø±Ø­Ù„Ù‡ Û±: Ø¯Ø±ÛŒØ§ÙØª API Credentials

1. Ø¨Ù‡ [https://my.telegram.org](https://my.telegram.org) Ø¨Ø±ÙˆÛŒØ¯
2. Ø¨Ø§ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ø®ÙˆØ¯ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯
3. Ø¨Ù‡ **API development tools** Ø¨Ø±ÙˆÛŒØ¯
4. ÛŒÚ© Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯ Ùˆ `API_ID` Ùˆ `API_HASH` Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯

#### Ù…Ø±Ø­Ù„Ù‡ Û²: Ù†ØµØ¨ Telethon

```powershell
pip install telethon
```

#### Ù…Ø±Ø­Ù„Ù‡ Û³: Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ ÙØ§ÛŒÙ„ .env

```env
# Ø¯Ø± ÙØ§ÛŒÙ„ .env Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
TELEGRAM_API_ID=YOUR_API_ID
TELEGRAM_API_HASH=YOUR_API_HASH
TELEGRAM_PHONE=+989123456789
```

#### Ù…Ø±Ø­Ù„Ù‡ Û´: ØªØ³Øª Ø§Ø³Ú©Ø±ÛŒÙ¾Øª

```powershell
python channel_reader.py
```

Ø§ÙˆÙ„ÛŒÙ† Ø¨Ø§Ø± Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù… Ø´Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.

#### Ù…Ø±Ø­Ù„Ù‡ Ûµ: Ø§Ø¯ØºØ§Ù… Ø¨Ø§ Ø±Ø¨Ø§Øª Ø§ØµÙ„ÛŒ

ÙØ§ÛŒÙ„ `bot.py` Ø±Ø§ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù†ÛŒØ¯ Ùˆ Ø§Ø² `channel_reader.py` Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:

```python
# Ø¯Ø± bot.py
from channel_reader import read_channel_message

async def fetch_and_calculate(application: Application) -> str:
    try:
        # Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Telethon Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø¯Ù† Ú©Ø§Ù†Ø§Ù„
        text = read_channel_message(SOURCE_CHANNEL)
        
        if not text:
            return "âŒ Ù¾ÛŒØ§Ù…ÛŒ Ø§Ø² Ú©Ø§Ù†Ø§Ù„ ÛŒØ§ÙØª Ù†Ø´Ø¯"
        
        # Ø§Ø¯Ø§Ù…Ù‡ Ú©Ø¯...
```

âœ… **Ù…Ø²Ø§ÛŒØ§:** Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ†  
âš ï¸ **Ù…Ø¹Ø§ÛŒØ¨:** Ù†ÛŒØ§Ø² Ø¨Ù‡ session ÙØ¹Ø§Ù„ (Ø¨Ø§ÛŒØ¯ ÛŒÚ©Ø¨Ø§Ø± login Ú©Ù†ÛŒØ¯)

---

### Ø±Ø§Ù‡â€ŒØ­Ù„ Û³: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Web Scraping

Ø§Ú¯Ø± Ú©Ø§Ù†Ø§Ù„ Ø¯Ø§Ø±Ø§ÛŒ Ù„ÛŒÙ†Ú© Ø¹Ù…ÙˆÙ…ÛŒ Ø§Ø³Øª (Ù…Ø«Ù„ `https://t.me/s/tetherprice_toman`)ØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø§ web scraping Ù…Ø­ØªÙˆØ§ Ø±Ø§ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯.

#### Ù…Ø±Ø­Ù„Ù‡ Û±: Ù†ØµØ¨ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§

```powershell
pip install beautifulsoup4 requests
```

#### Ù…Ø±Ø­Ù„Ù‡ Û²: Ø§ÛŒØ¬Ø§Ø¯ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Scraper

```python
import requests
from bs4 import BeautifulSoup

def scrape_channel(channel_username):
    url = f"https://t.me/s/{channel_username}"
    response = requests.get(url)
    soup = BeautifulSoup(response.text, 'html.parser')
    
    # Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø¢Ø®Ø±ÛŒÙ† Ù¾ÛŒØ§Ù…
    messages = soup.find_all('div', class_='tgme_widget_message_text')
    if messages:
        return messages[-1].get_text()
    
    return None
```

âœ… **Ù…Ø²Ø§ÛŒØ§:** Ø®ÛŒÙ„ÛŒ Ø³Ø§Ø¯Ù‡ØŒ Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ authentication  
âŒ **Ù…Ø¹Ø§ÛŒØ¨:** Ù…Ù…Ú©Ù† Ø§Ø³Øª ØªÙ„Ú¯Ø±Ø§Ù… Ø³Ø§Ø®ØªØ§Ø± HTML Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡Ø¯

---

### Ø±Ø§Ù‡â€ŒØ­Ù„ Û´: Webhook / Forward (ØªÙˆØµÛŒÙ‡â€ŒØ´Ø¯Ù‡)

Ø¨Ù‡ØªØ±ÛŒÙ† Ø±Ø§Ù‡ Ø­Ù„ Ø¨Ø±Ø§ÛŒ Ù…Ø­ÛŒØ· production:

1. ÛŒÚ© Ú©Ø§Ù†Ø§Ù„/Ú¯Ø±ÙˆÙ‡ Ø®ØµÙˆØµÛŒ Ø¨Ø³Ø§Ø²ÛŒØ¯
2. Ø§Ø² Ø®ÙˆØ¯ Ú©Ø§Ù†Ø§Ù„ `@tetherprice_toman` Ø¹Ø¶Ùˆ Ø´ÙˆÛŒØ¯
3. Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ù†Ø§Ù„ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡ Ú¯Ø±ÙˆÙ‡/Ú©Ø§Ù†Ø§Ù„ Ø®ØµÙˆØµÛŒ Ø®ÙˆØ¯ forward Ú©Ù†ÛŒØ¯
4. Ø±Ø¨Ø§Øª Ø±Ø§ Ø¨Ù‡ Ø¢Ù† Ú¯Ø±ÙˆÙ‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯ Ùˆ Ø§Ø² Ø¢Ù†Ø¬Ø§ Ø¨Ø®ÙˆØ§Ù†Ø¯

#### Ù†Ø­ÙˆÙ‡ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ:

```python
# Ø¯Ø± bot.py ÛŒÚ© handler Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù†Ø§Ù„ Ø®ØµÙˆØµÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
from telegram.ext import MessageHandler, filters

async def handle_forwarded_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ forward Ø´Ø¯Ù‡ Ø§Ø² Ú©Ø§Ù†Ø§Ù„"""
    if update.channel_post:
        text = update.channel_post.text
        # Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…ØªÙ†...
        tether_price = bot_instance.extract_tether_price(text)
        if tether_price:
            # Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ø§Ø±Ø³Ø§Ù„...
            pass

# Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† handler
application.add_handler(MessageHandler(
    filters.ChatType.CHANNEL, 
    handle_forwarded_message
))
```

âœ… **Ù…Ø²Ø§ÛŒØ§:** Ù‚Ø§Ø¨Ù„ Ø§Ø¹ØªÙ…Ø§Ø¯ØŒ Ø¨Ø¯ÙˆÙ† Ù…Ø´Ú©Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ  
âœ… **Ù…Ø¹Ø§ÛŒØ¨:** Ù†ÛŒØ§Ø² Ø¨Ù‡ ÛŒÚ© Ú©Ø§Ù†Ø§Ù„ Ù…ÛŒØ§Ù†ÛŒ

---

## Ø±Ø§Ù‡â€ŒØ­Ù„ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ù†Ù‡Ø§ÛŒÛŒ

**Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ø¨Ù‡ØªØ±ÛŒÙ† Ø±ÙˆØ´: Ø±Ø§Ù‡â€ŒØ­Ù„ Û´ (Webhook/Forward)**

### Ù…Ø±Ø§Ø­Ù„:

1. **ÛŒÚ© Ú©Ø§Ù†Ø§Ù„ Ø®ØµÙˆØµÛŒ Ø¨Ø³Ø§Ø²ÛŒØ¯** (Ù…Ø«Ù„Ø§Ù‹: `my_tether_cache`)
2. **Ø±Ø¨Ø§Øª Ø±Ø§ Ø¨Ù‡ Ø§ÛŒÙ† Ú©Ø§Ù†Ø§Ù„ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯** Ùˆ Ø§Ø¯Ù…ÛŒÙ†Ø´ Ú©Ù†ÛŒØ¯
3. **Ù‡Ø± Ø±ÙˆØ² Ø¯Ø³ØªÛŒ** ÛŒØ§ Ø¨Ø§ ÛŒÚ© **bot Ø¯ÛŒÚ¯Ø±** Ù¾ÛŒØ§Ù… Ú©Ø§Ù†Ø§Ù„ `@tetherprice_toman` Ø±Ø§ Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ Ø®ØµÙˆØµÛŒ Ø®ÙˆØ¯ forward Ú©Ù†ÛŒØ¯
4. **Ø±Ø¨Ø§Øª Ø§ØµÙ„ÛŒ** Ø§Ø² Ø§ÛŒÙ† Ú©Ø§Ù†Ø§Ù„ Ø®ØµÙˆØµÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ø¯

### Ú©Ø¯ Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø¯Ù† Ø§Ø² Ú©Ø§Ù†Ø§Ù„ Ø®ØµÙˆØµÛŒ:

Ø¯Ø± `bot.py` ØªØ§Ø¨Ø¹ `fetch_and_calculate` Ø±Ø§ Ø¨Ù‡ Ø§ÛŒÙ† Ø´Ú©Ù„ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯:

```python
async def fetch_and_calculate(application: Application) -> str:
    try:
        # Ø®ÙˆØ§Ù†Ø¯Ù† Ø§Ø² Ú©Ø§Ù†Ø§Ù„ Ø®ØµÙˆØµÛŒ Ú©Ù‡ Ø±Ø¨Ø§Øª Ø§Ø¯Ù…ÛŒÙ† Ø¢Ù† Ø§Ø³Øª
        private_channel_id = os.getenv('PRIVATE_CHANNEL_ID')  # Ù…Ø«Ù„: -1001234567890
        
        # Ø¯Ø±ÛŒØ§ÙØª Ø¢Ø®Ø±ÛŒÙ† Ù¾ÛŒØ§Ù…
        updates = await application.bot.get_updates(limit=100)
        
        latest_message = None
        for update in reversed(updates):
            if (update.channel_post and 
                str(update.channel_post.chat.id) == private_channel_id):
                latest_message = update.channel_post.text
                break
        
        if not latest_message:
            return "âŒ Ù¾ÛŒØ§Ù…ÛŒ Ø§Ø² Ú©Ø§Ù†Ø§Ù„ ÛŒØ§ÙØª Ù†Ø´Ø¯"
        
        # Ø§Ø¯Ø§Ù…Ù‡ Ù…Ø­Ø§Ø³Ø¨Ø§Øª...
```

---

## Ù†ØªÛŒØ¬Ù‡â€ŒÚ¯ÛŒØ±ÛŒ

| Ø±ÙˆØ´ | Ø³Ø®ØªÛŒ | Ù‚Ø§Ø¨Ù„ÛŒØª Ø§Ø¹ØªÙ…Ø§Ø¯ | ØªÙˆØµÛŒÙ‡ |
|-----|------|---------------|-------|
| Ø±Ø¨Ø§Øª Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ Ø§ØµÙ„ÛŒ | â­ | â­â­â­â­â­ | Ø§Ú¯Ø± Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ø¯Ø§Ø±ÛŒØ¯ |
| Telethon | â­â­â­ | â­â­â­â­ | Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ùˆ ØªÙˆØ³Ø¹Ù‡ |
| Web Scraping | â­â­ | â­â­ | Ø®ÛŒØ± |
| Ú©Ø§Ù†Ø§Ù„ Ù…ÛŒØ§Ù†ÛŒ | â­â­ | â­â­â­â­â­ | âœ… **Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ** |

---

**Ø³ÙˆØ§Ù„ Ø¯Ø§Ø±ÛŒØ¯ØŸ** Ø¯Ø± Issues Ú¯ÛŒØªâ€ŒÙ‡Ø§Ø¨ Ø¨Ù¾Ø±Ø³ÛŒØ¯!
