# 📊 خلاصه پروژه - ربات تلگرام محاسبه نرخ یوآن

## ✅ وضعیت پروژه

پروژه **کامل** و آماده استفاده است! 🎉

---

## 📁 فایل‌های ایجاد شده

| فایل | توضیحات | وضعیت |
|------|---------|-------|
| `bot.py` | کد اصلی ربات تلگرام | ✅ کامل |
| `requirements.txt` | وابستگی‌های Python | ✅ کامل |
| `.env.example` | نمونه فایل تنظیمات | ✅ کامل |
| `.gitignore` | فایل‌های نادیده گرفته شده | ✅ کامل |
| `.github/workflows/update_rate.yml` | GitHub Actions workflow | ✅ کامل |
| `README.md` | مستندات اصلی | ✅ کامل |
| `TUTORIAL.md` | آموزش گام‌به‌گام | ✅ کامل |
| `ADVANCED.md` | راهنمای پیشرفته | ✅ کامل |
| `QUICKSTART.md` | راهنمای سریع | ✅ کامل |
| `test_bot.py` | اسکریپت تست | ✅ کامل |
| `channel_reader.py` | خواندن کانال با Telethon | ✅ کامل |
| `data.json.example` | نمونه ساختار داده | ✅ کامل |
| `LICENSE` | لایسنس MIT | ✅ کامل |

---

## 🎯 قابلیت‌های پیاده‌سازی شده

### ✅ قابلیت‌های اصلی

1. **دریافت خودکار نرخ تتر** از کانال تلگرام
2. **محاسبه هوشمند نرخ مبنا** با رند کردن به بالا
3. **شرط حفظ نرخ**: اگر نرخ جدید کمتر شد، از نرخ قبلی استفاده می‌شود
4. **ارسال خودکار** پیام به گروه تلگرام
5. **ذخیره دائمی داده‌ها** در فایل JSON

### ✅ اجرای خودکار

- استفاده از **GitHub Actions** برای اجرای بدون سرور
- زمان‌بندی: **هر ساعت از ۱۱ صبح تا ۷ شب** (منطقه زمانی تهران)
- **۹ بار در روز** اجرا می‌شود

### ✅ کنترل دستی

دستورات تلگرام:
- `/start` - راهنما
- `/setrate <نرخ>` - تنظیم نرخ یوآن
- `/getrate` - نمایش نرخ فعلی
- `/status` - وضعیت ربات
- `/update` - به‌روزرسانی دستی

### ✅ پشتیبانی از دو روش خواندن کانال

1. **کانال عمومی** (محدودیت دارد)
2. **کانال میانی خصوصی** (پیشنهادی) ⭐

---

## 🔢 نحوه محاسبه

```
مثال:
  قیمت فروش تتر: 1,084,980 ریال
  نرخ یوآن: 7.12

محاسبه:
  1. تبدیل به تومان: 1,084,980 ÷ 10 = 108,498 تومان
  2. تقسیم بر نرخ یوآن: 108,498 ÷ 7.12 = 15,238.48
  3. رند به بالا (نزدیکترین ۱۰): 15,240 تومان

نتیجه:
  • نرخ مبنا: 15,240 تومان
  • خرید تا 5 هزار یوآن: 15,300 تومان (+60)
  • خرید تا 10 هزار یوآن: 15,290 تومان (+50)
  • خرید بالای 10 هزار یوآن: 15,280 تومان (+40)
```

---

## 📝 مراحل راه‌اندازی (خلاصه)

### مرحله ۱: ساخت ربات تلگرام
```
1. به @BotFather پیام دهید
2. دستور /newbot بزنید
3. توکن را دریافت کنید
```

### مرحله ۲: تنظیم گروه
```
1. گروه جدید بسازید
2. ربات را اضافه کنید
3. شناسه گروه را دریافت کنید
```

### مرحله ۳: GitHub
```
1. ریپازیتوری جدید بسازید
2. فایل‌ها را آپلود کنید
3. Secrets را تنظیم کنید:
   - BOT_TOKEN
   - TARGET_GROUP_ID
   - PRIVATE_CHANNEL_ID (اختیاری)
```

### مرحله ۴: فعال‌سازی
```
1. GitHub Actions را enable کنید
2. نرخ یوآن را با /setrate تنظیم کنید
3. تست کنید!
```

---

## 🚨 نکات مهم

### ⚠️ مشکل خواندن کانال عمومی

ربات‌های تلگرام **نمی‌توانند مستقیماً** از کانال‌های عمومی بخوانند.

**راه‌حل پیشنهادی:**
1. یک کانال خصوصی بسازید
2. ربات را به آن اضافه و ادمین کنید
3. پیام‌های کانال `@tetherprice_toman` را به آن forward کنید
4. `PRIVATE_CHANNEL_ID` را در Secrets تنظیم کنید

**راه‌حل جایگزین:**
- استفاده از Telethon (نیاز به API credentials)
- خواندن دستی توسط شما

### ✅ استفاده روزانه

**هر روز قبل از ساعت ۱۱:**
```
/setrate 7.15
```

**در صورت استفاده از کانال میانی:**
- پیام جدید را از `@tetherprice_toman` forward کنید

---

## 📊 معماری سیستم

```
┌─────────────────────────────────────────────────────────┐
│                    GitHub Actions                       │
│  (هر ساعت از ۱۱ صبح تا ۷ شب - منطقه زمانی تهران)      │
└─────────────────────┬───────────────────────────────────┘
                      │
                      ▼
         ┌────────────────────────┐
         │   اجرای bot.py        │
         └───────┬────────────────┘
                 │
                 ▼
    ┌────────────────────────────┐
    │  بررسی نرخ یوآن (data.json)│
    └───────┬────────────────────┘
            │
            ▼
    ┌───────────────────────────────┐
    │ خواندن از کانال              │
    │ (عمومی یا میانی)              │
    └───────┬───────────────────────┘
            │
            ▼
    ┌──────────────────────────┐
    │ استخراج قیمت فروش تتر   │
    └───────┬──────────────────┘
            │
            ▼
    ┌──────────────────────────┐
    │ محاسبه نرخ مبنا          │
    │ + رند کردن به بالا       │
    └───────┬──────────────────┘
            │
            ▼
    ┌──────────────────────────┐
    │ بررسی شرط کاهش نرخ      │
    └───────┬──────────────────┘
            │
            ▼
    ┌──────────────────────────┐
    │ محاسبه قیمت‌های نهایی   │
    └───────┬──────────────────┘
            │
            ▼
    ┌──────────────────────────┐
    │ ارسال پیام به گروه       │
    └───────┬──────────────────┘
            │
            ▼
    ┌──────────────────────────┐
    │ ذخیره داده‌ها در GitHub  │
    └──────────────────────────┘
```

---

## 🧪 تست

### تست محلی
```powershell
python test_bot.py
```

خروجی مورد انتظار:
```
🧪 شروع تست‌های ربات...

1️⃣ تست استخراج قیمت از متن کانال
✅ قیمت استخراج شده: 1,084,980 ریال

2️⃣ تست محاسبه نرخ مبنا
✅ نرخ مبنا محاسبه شده: 15,240 تومان

3️⃣ تست قالب‌بندی پیام نهایی
...

✅ همه تست‌ها با موفقیت انجام شد!
```

---

## 📖 مستندات

| فایل | برای چه کسی |
|------|-------------|
| `QUICKSTART.md` | شروع سریع (۵ دقیقه) |
| `TUTORIAL.md` | آموزش کامل قدم‌به‌قدم |
| `README.md` | مرجع کامل |
| `ADVANCED.md` | تنظیمات پیشرفته |

---

## 🎉 آماده استفاده!

پروژه کامل است و می‌توانید:

1. **فایل‌ها را به GitHub آپلود کنید**
2. **Secrets را تنظیم کنید**
3. **نرخ یوآن را با `/setrate` بدهید**
4. **ربات خودکار کار می‌کند!**

---

## 📞 پشتیبانی و توسعه

### مشکلی پیش آمد؟
1. لاگ‌های GitHub Actions را بررسی کنید
2. `/status` را در تلگرام بزنید
3. فایل `data.json` را چک کنید
4. مستندات را مطالعه کنید

### توسعه‌های آینده
- [ ] ارسال به واتس‌اپ
- [ ] دریافت خودکار نرخ یوآن از API
- [ ] پشتیبانی از چندین گروه
- [ ] گزارش روزانه
- [ ] نمودار تغییرات

---

## 🏆 ویژگی‌های برجسته

✅ **بدون سرور** - GitHub Actions  
✅ **رایگان ۱۰۰%**  
✅ **اجرای خودکار** - هر ساعت  
✅ **قابل اعتماد** - با لاگ کامل  
✅ **مستندات کامل فارسی**  
✅ **منبع باز** - MIT License  

---

**موفق باشید! 🚀**

شروع کنید با: `QUICKSTART.md` یا `TUTORIAL.md`
